name: Generate Slug

on:
  workflow_call:
    inputs:
      value:
        description: 'Value to slugify'
        required: true
        type: string
    outputs:
      slug:
        description: 'Slugified value'
        value: ${{ jobs.generate-slug.outputs.slug }}

jobs:
  generate-slug:
    runs-on: ubuntu-latest
    outputs:
      slug: ${{ steps.slugify.outputs.slug }}

    steps:
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: '1.21'

      - name: Generate slug
        id: slugify
        run: |
          # Créer un script Go temporaire
          cat > /tmp/slugify.go << 'EOF'
          package main
          
          import (
              "fmt"
              "os"
              "github.com/gosimple/slug"
          )
          
          func main() {
              if len(os.Args) < 2 {
                  fmt.Println("Usage: slugify <text>")
                  os.Exit(1)
              }
          
              text := os.Args[1]
              slugged := slug.Make(text)
              fmt.Println(slugged)
          }
          EOF
          
          # Compiler
          cd /tmp
          go mod init slugify
          go get github.com/gosimple/slug
          go build -o slugify slugify.go
          
          # Générer le slug
          BRANCH_NAME="${{ inputs.branch-name }}"
          echo "Input branch: $BRANCH_NAME"
          
          SLUG=$(/tmp/slugify "$BRANCH_NAME")
          echo "Generated slug: $SLUG"
          
          # Exporter
          echo "slug=$SLUG" >> $GITHUB_OUTPUT